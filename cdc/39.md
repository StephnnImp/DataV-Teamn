# `0x39` CDC Status

CDC `0x18` â†’ Radio `0x68`

*Original CD changer (not MP3)!*

This command is used to report the status of the CD changer to the radio. 

The radio is responsible for controlling the CD changer, which is does via [CDC Request](#) `0x38`.

### Related Commands

- `0x38` [CDC Request](#)

### Examples

    # CD Changer (1997), Radio: BM C23
    18 0A 68 39 02 09 00 01 00 01 09 41
    18 0A 68 39 02 09 00 21 00 07 63 0D
    18 0A 68 39 03 02 00 21 00 07 64 00
    18 0A 68 39 03 09 00 01 00 01 05 4C
    18 0A 68 39 05 09 00 01 00 01 02 4D
    18 0A 68 39 05 09 00 01 00 01 03 4C
    18 0A 68 39 05 09 00 01 00 01 04 4B
    18 0A 68 39 05 09 00 01 00 01 05 4A
    18 0A 68 39 02 09 00 3F 00 01 01 77
    
    # CD Changer (2001), Radio: BM53
    18 0E 68 39 00 82 00 01 00 01 03 00 01 01 01 C7
    18 0E 68 39 02 89 00 01 00 01 09 00 01 01 01 C4
    18 0E 68 39 01 8C 00 01 00 01 01 00 01 01 01 CA
    18 0E 68 39 04 89 00 01 00 01 13 00 01 01 01 D8

## Parameters

Fixed length. 7 data bytes.

Parameter|Index|Length|Type
:--------|:----|:-----|:---
Status   |`0`  |`1`   |Bitfield
Audio?   |`1`  |`1`   |Bitfield
Error    |`2`  |`1`   |Bitfield
Magazine |`3`  |`1`   |Bitfield
Unknown  |`4`  |`1`   |Unknown
Disc     |`5`  |`1`   |Integer
Track    |`6`  |`1`   |Integer

### Status

    0x00: Stopped
    0x01: Paused
    0x02: Playing
    0x03: FFW
    0x04: RWD
    0x05: Next Track
    0x06: Previous Track
    0x07: Pending/Acknowledge
    0x08: Magazine Ready
    0x09: Magazine Checking
    0x0a: Magazine Ejecting

### Audio?

The apparent partial duplication of the Status byte suggests this has a different use. Possibly to do with flagging when CD changer is outputting audio?

    # CD Changer (1997)
    0x02: Stopped
    0x09: Playing
    0x0c: Ready?
    
    # CD Changer (2001)
    0x82: Stopped
    0x89: Playing
    0x8c: Ready?

### Error

The sporadic values listed here suggest there are other errors, i.e. `0x01`, `0x04` etc.

    0x02: High Temp
    0x08: No Disc
    0x10: No Magazine

### Magazine

This denotes which slots in the CD changer magazine are loaded with a disc.

    MAGAZINE_SLOT_1 = 0b0010_0000
    MAGAZINE_SLOT_2 = 0b0001_0000
    MAGAZINE_SLOT_3 = 0b0000_1000
    MAGAZINE_SLOT_4 = 0b0000_0100
    MAGAZINE_SLOT_5 = 0b0000_0010
    MAGAZINE_SLOT_6 = 0b0000_0001

### Unknown

I've only ever seen this with a value of `0x00`.

### Disc

Integer.

I've not confirmed the encoding here. The MK1 GT applies a mask to the CD changer display which only allows a single digit for CD number.

> To have the 'Track' layout applied, the below format must be used otherwise the zone defaults to 11 characters without a layout.
> 
> Pattern = `"CD [0-9]{1}-[a-zA-Z0-9]{2}"`

    cdc     rad     CDC             00 09 00 00 00 09 09
    rad     gt      RAD-23          gt: 0xcb ((CD) Empty Casette Track Change?) / ike: 0x20 (Clear) / chars: 43 44 20 39 2D 30 39 ("CD 9-09")

### Track

Integer. Binary coded deciaml.

I've tested this up to track 

    # Example: CDC Track No. 12
    18 .. 68 39 02 09 00 01 00 01 12 ..         # Track 0x12
    68 .. 3b 23 c4 20 43 44 20 31 2D 31 32 ..   # "CD 1-12"
    
    # Example: CDC Track No. 16
    18 .. 68 39 00 02 00 01 00 01 16 ..         # Track 0x16
    68 .. 3b 23 c4 20 43 44 20 31 2D 31 36 ..   # "CD 1-16"

## Use Cases

I haven't been exhaustive here as the behaviour can be a little inconsistent between radios/CD changers. I've attempted to highlight a few 'gothchas'.

### Acknowledge

The radio and CD changer have a tumultuous relationship...

When the radio issues a request `0x38`, it expects a **specific** response. Not only that, the radio expects a **prompt** response.

If the radio does not receive a timely, correct reply, it will effectively berate the CD changer until it does so.

In the event that the CD changer can't immediately perform the requested action, i.e. the disc needs to spin up, the CD changer issues an acknowledgement of sorts, thus satisfying the radio's need for a timely response.

When capable, the CD changer replies again with a status that reflects the earlier radio request.

    68 05 18 38 03 00 4E                # PLAY! NOW!
    18 0A 68 39 07 09 00 01 00 01 02 4F # Yes, sir, I'm on it, stand by!
    # Time passes...
    18 0A 68 39 02 09 00 01 00 01 02 4A # Playing, sir!


Similarly, if the CDC speaks out of turn, i.e. when the radio is supposed to be off, and the CDC says anything other than "Stopped", the radio will yell at the CDC to stop.

### No Disc

    # Based on last 0x39 update, the radio is aware that
    # the magazine does not have discs in slots 3 and 4
    18 .. 68 39 02 09 00 33 00 02 01 ..
    
    # Thus, when user presses "3" on BMBT (to load disc 3)...
    f0 .. 68 48 12 ..
    
    # The radio can display "NO DISC" on display
    68 .. 3b 23 c2 20 4E 4F 20 44 49 53 43 .. # "NO DISC"

### No Magazine, CD Check

rad     gt      RAD-23          gt: 0xc1 ((CD) No Magazine) / ike: 0x20 (Clear) / chars: 4E 4F 20 4D 41 47 41 5A 49 4E 45 ("NO MAGAZINE")
bmbt    rad     BMBT-RAD*       0x86 (1000 0110) :bmbt_power            [Power]         Release
cdc     rad     CDC             0A 02 00 3F 00 00 00
rad     cdc     CDC-REQ         control: 00 (Status!) / mode: 00 (mode: "00")
cdc     rad     CDC             0A 02 00 3F 00 00 00
cdc     rad     CDC             09 02 00 3F 00 00 00
rad     gt      RAD-23          gt: 0xc3 ((CD) CD Check) / ike: 0x20 (Clear) / chars: 43 44 20 43 48 45 43 4B ("CD CHECK")
